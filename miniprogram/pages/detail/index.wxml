<view style="padding-bottom: 24rpx;">
  <view wx:if="{{loading}}" style="padding: 24rpx; color:#6b7280;">加载中…</view>
  <view wx:if="{{!loading && !item}}" style="padding: 24rpx; color:#6b7280;">内容不存在或已下架</view>

  <view wx:if="{{item}}">
    <view style="position: relative; background:#000;">
      <swiper
        autoplay="false"
        circular="false"
        style="height: {{heroHeightPx}}px;"
        current="{{swiperIndex}}"
        bindchange="onSwiperChange"
      >
        <block wx:for="{{item.mediaList}}" wx:key="index">
          <swiper-item>
            <block wx:if="{{item.kind==='video'}}">
              <video src="{{item.url}}" controls="true" style="width:100%; height: {{heroHeightPx}}px;"></video>
            </block>
            <block wx:else>
              <image
                src="{{item.url}}"
                mode="aspectFill"
                style="width:100%; height: {{heroHeightPx}}px;"
                bindtap="onPreviewMedia"
                data-index="{{index}}"
              />
            </block>
          </swiper-item>
        </block>
      </swiper>

      <view
        style="position:absolute; right: 18rpx; bottom: 18rpx; padding: 8rpx 14rpx; border-radius: 999rpx; color:#fff; font-size: 22rpx; background: rgba(0,0,0,0.45);"
      >
        {{swiperIndex + 1}}/{{item.mediaList.length}}
      </view>
    </view>

    <view class="card" style="margin: 20rpx 24rpx 0; padding: 24rpx;">
      <view style="display:flex; align-items:flex-start; justify-content:space-between; gap: 16rpx;">
        <view style="flex:1; min-width:0;">
          <view style="font-size: 34rpx; font-weight: 900; line-height: 44rpx;">{{item.title}}</view>
          <view style="margin-top: 10rpx; display:flex; gap: 10rpx; flex-wrap:wrap; align-items:center;">
            <view style="font-size: 22rpx; color:#6b7280; padding: 6rpx 10rpx; background:#f3f4f6; border-radius: 999rpx;">{{item.category}}</view>
            <view style="font-size: 22rpx; color:#6b7280; padding: 6rpx 10rpx; background:#f3f4f6; border-radius: 999rpx;">{{item.type==='package' ? '服务' : '作品'}}</view>
          </view>
        </view>
        <view style="display:flex; align-items:center; gap: 10rpx;" bindtap="toggleLike">
          <text style="font-size: 34rpx; color: {{item.isLiked ? '#ef4444' : '#6b7280'}};">♥</text>
          <text style="font-size: 26rpx; color:#6b7280;">{{item.likeCount}}</text>
        </view>
      </view>

      <view wx:if="{{item.type==='package'}}" style="margin-top: 16rpx; display:flex; align-items:baseline; justify-content:space-between; gap: 16rpx;">
        <view style="font-size: 24rpx; color:#6b7280;">基础价 ¥ {{item.basePrice}}</view>
        <view style="font-size: 34rpx; font-weight: 900; color:#ef4444;">¥ {{price.total}}</view>
      </view>
      <view wx:if="{{item.description}}" style="margin-top: 14rpx; font-size: 26rpx; color:#374151; line-height: 38rpx;">{{item.description}}</view>
    </view>

    <view wx:if="{{thumbs.length>1}}" style="margin: 16rpx 24rpx 0;">
      <scroll-view scroll-x="true" show-scrollbar="false" style="white-space: nowrap;">
        <view style="display:inline-flex; gap: 12rpx; padding-bottom: 6rpx;">
          <block wx:for="{{thumbs}}" wx:key="index">
            <view style="position: relative; width: 160rpx; height: 160rpx; border-radius: 20rpx; overflow:hidden; background:#e5e7eb;" bindtap="onPreviewMedia" data-index="{{item.index}}">
              <image wx:if="{{item.kind==='image'}}" src="{{item.url}}" mode="aspectFill" style="width:100%; height:100%;" />
              <view wx:if="{{item.kind==='video'}}" style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:#fff; font-size: 26rpx; background: rgba(0,0,0,0.25);">视频</view>
            </view>
          </block>
        </view>
      </scroll-view>
    </view>

    <view wx:if="{{item.type==='package'}}" style="padding: 0 24rpx;">
      <view style="margin: 20rpx 0 12rpx; font-size: 30rpx; font-weight: 900;">套餐内容</view>

      <block wx:for="{{item.includedGroups}}" wx:key="id" wx:for-item="incGroup">
        <view class="card" style="padding: 24rpx; margin-bottom: 16rpx;">
          <view style="display:flex; align-items:flex-end; justify-content:space-between; gap: 16rpx;">
            <view style="font-size: 30rpx; font-weight: 900;">{{incGroup.name}}</view>
          </view>

          <view style="margin-top: 16rpx; display:grid; grid-template-columns: 1fr 1fr; gap: 12rpx;">
            <block wx:for="{{incGroup.items}}" wx:key="id" wx:for-item="inc">
              <view style="border-radius: 18rpx; overflow:hidden; border: 2rpx solid #e5e7eb; background:#fff;">
                <view style="position:relative; width:100%; height: 180rpx; background:#f3f4f6;">
                  <image wx:if="{{inc.thumbUrl && inc.thumbKind==='image'}}" src="{{inc.thumbUrl}}" mode="aspectFit" style="width:100%; height:100%;" catchtap="onPreviewOptionThumb" data-url="{{inc.thumbUrl}}" data-urls="{{inc.imageUrls}}" />
                  <view wx:if="{{inc.thumbUrl && inc.thumbKind==='video'}}" style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:#fff; background: rgba(0,0,0,0.25); font-size: 24rpx;">视频</view>
                </view>
                <view style="padding: 14rpx 14rpx 12rpx; height: 140rpx; box-sizing: border-box;">
                  <view style="font-size: 26rpx; font-weight: 800; color:#111827; overflow:hidden; text-overflow: ellipsis; white-space: nowrap;">{{inc.name}}</view>
                  <view wx:if="{{inc.description}}" style="margin-top: 6rpx; font-size: 22rpx; color:#6b7280; line-height: 30rpx; overflow:hidden; display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:2;">{{inc.description}}</view>
                </view>
              </view>
            </block>
          </view>
        </view>
      </block>

      <view style="margin: 20rpx 0 12rpx; font-size: 30rpx; font-weight: 900;">可选项</view>

      <block wx:for="{{item.optionGroups}}" wx:key="id" wx:for-item="group">
        <view class="card" style="padding: 24rpx; margin-bottom: 16rpx;">
          <view style="display:flex; align-items:flex-end; justify-content:space-between; gap: 16rpx;">
            <view style="font-size: 30rpx; font-weight: 900;">{{group.name}}</view>
            <view style="font-size: 22rpx; color:#6b7280;">{{group.selectMode==='single' ? (group.required ? '请选1份' : '可选') : (group.required ? '请选择' : '可选')}} </view>
          </view>

          <view style="margin-top: 16rpx; display:grid; grid-template-columns: 1fr 1fr; gap: 12rpx;">
            <block wx:for="{{group.items}}" wx:key="id" wx:for-item="opt">
              <view
                style="border-radius: 18rpx; overflow:hidden; border: 2rpx solid {{opt.checked ? '#ef4444' : '#e5e7eb'}}; background:#fff;"
                bindtap="onTapOption"
                data-groupid="{{group.id}}"
                data-itemid="{{opt.id}}"
              >
                <view style="position:relative; width:100%; height: 180rpx; background:#f3f4f6;">
                  <image wx:if="{{opt.thumbUrl && opt.thumbKind==='image'}}" src="{{opt.thumbUrl}}" mode="aspectFit" style="width:100%; height:100%;" catchtap="onPreviewOptionThumb" data-url="{{opt.thumbUrl}}" data-urls="{{opt.imageUrls}}" />
                  <view wx:if="{{opt.thumbUrl && opt.thumbKind==='video'}}" style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:#fff; background: rgba(0,0,0,0.25); font-size: 24rpx;">视频</view>
                </view>
                <view style="padding: 14rpx 14rpx 12rpx; height: 140rpx; box-sizing: border-box;">
                  <view style="font-size: 26rpx; font-weight: 800; color:#111827; overflow:hidden; text-overflow: ellipsis; white-space: nowrap;">{{opt.name}}</view>
                  <view wx:if="{{opt.description}}" style="margin-top: 6rpx; font-size: 22rpx; color:#6b7280; line-height: 30rpx; overflow:hidden; display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:2;">{{opt.description}}</view>
                  <view style="margin-top: 8rpx; font-size: 24rpx; font-weight: 800; color:#ef4444;">{{opt.deltaText}}</view>
                </view>
              </view>
            </block>
          </view>

        </view>
      </block>
    </view>
  </view>

</view>
